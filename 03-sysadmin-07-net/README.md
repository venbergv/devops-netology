# Домашнее задание к занятию "3.7. Компьютерные сети, лекция 2"

1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

---

Ответ.

```
vagrant@vagrant:~$ ip -br -c link
lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP> 
eth0             UP             08:00:27:73:60:cf <BROADCAST,MULTICAST,UP,LOWER_UP> 
vagrant@vagrant:~$ 
```

*Для Linux -* `ip link`.  
*Для Windows -* `ipcofig`.

---

2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

---

Ответ.

*Используется протокол LLDP.*  
*Пакет в Linux -* `lldp`.  
*Команда в Linux -* `lldpctl`.

---

3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

---

Ответ.

*Используется технология* `VLAN`.  
*Стандарт Ethernet 802.1q*  
*Пакет для Linux -* `vlan`  
*В современных Linux Ubuntu для создания VLAN надо использовать утилиты из* `iproute2`. *Или прописывать конфигурацию сети в* `netplan`.


```
vagrant@vagrant:~$ sudo apt install vlan
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following NEW packages will be installed:
  vlan
0 upgraded, 1 newly installed, 0 to remove and 104 not upgraded.
Need to get 11.3 kB of archives.
After this operation, 50.2 kB of additional disk space will be used.
Get:1 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 vlan all 2.0.4ubuntu1.20.04.1 [11.3 kB]
Fetched 11.3 kB in 0s (121 kB/s) 
Selecting previously unselected package vlan.
(Reading database ... 76239 files and directories currently installed.)
Preparing to unpack .../vlan_2.0.4ubuntu1.20.04.1_all.deb ...
Unpacking vlan (2.0.4ubuntu1.20.04.1) ...
Setting up vlan (2.0.4ubuntu1.20.04.1) ...
Processing triggers for man-db (2.9.1-1) ...
vagrant@vagrant:~$ sudo modprobe 8021q
vagrant@vagrant:~$ sudo ip link add link eth0 name eth0.200 type vlan id 200
vagrant@vagrant:~$ sudo ip link set up eth0.200
vagrant@vagrant:~$ ip link
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN mode DEFAULT group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP mode DEFAULT group default qlen 1000
    link/ether 08:00:27:73:60:cf brd ff:ff:ff:ff:ff:ff
3: eth0.200@eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP mode DEFAULT group default qlen 1000
    link/ether 08:00:27:73:60:cf brd ff:ff:ff:ff:ff:ff
vagrant@vagrant:~$ 
```


---

4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

---

Ответ.


*Для Linux сейчас используют teamin и bonding.*  
*Для балансировки нагрузки можно использовать следующие режимы:*



    mode = 0 (round robin) 

Круговой, циклически использует физические интерфейсы для передачи пакетов. Рекомендован для включения «по умолчанию». Этот режим работает с максимальной отдачей

    mode = 1 (active-backup)

Работает только один интерфейс, остальные находятся в очереди горячей замены. Если ведущий интерфейс перестает функционировать, то его нагрузку подхватывает следующий (присвоив mac-адрес) и становится активным. Дополнительная настройка коммутатора не требуется.

    mode = 2 (balance-xor)

XOR политика: Передача на основе [(исходный MAC-адрес → XOR → MAC-адрес получателя) %число интерфейсов]. Эта команда выбирает для каждого получателя определенный интерфейс в соответствии с mac-адресом. Режим обеспечивает балансировку нагрузки и отказоустойчивость.

    mode = 3 (broadcast)

Все пакеты передаются на все интерфейсы в группе. Режим обеспечивает отказоустойчивость.

    mode = 4 (802.3ad)

IEEE 802.3ad Dynamic Link aggregation (динамическое объединение каналов). Создает агрегации групп, имеющие одни и те же скорости и дуплексные настройки. Использует все включенные интерфейсы в активном агрегаторе согласно спецификации 802.3ad.  
Предварительные реквизиты  
Поддержка ethtool (позволяет отображать или изменять настройки сетевой карты) базы драйверов для получения скорости и дуплекса каждого интерфейса.  
Коммутатор с поддержкой IEEE 802.3ad Dynamic Link aggregation. Большинство параметров потребует некоторой конфигурации для режима 802.3ad.

    mode =5 (balance-tlb)

Адаптивная балансировка передаваемой нагрузки: канал связи не требует какой либо специальной настройки. Исходящий трафик распределяется в соответствии с текущей нагрузкой (вычисляется по скоростям) для каждого интерфейса. Входящий трафик принимается текущим интерфейсом. Если принимающий интерфейс выходит из строя, то следующий занимает его место приватизировав его mac-адрес.  
Поддержка ethtool (позволяет отображать или изменять настройки сетевой карты) базы драйверов для получения скорости и дуплекса каждого интерфейса.

    mode = 6 (balance-alb)

Адаптивное перераспределение нагрузки: включает balance-tlb плюс receive load balancing (rlb) для трафика IPv4 и не требует специального конфигурирования. То есть все так же как и при mode =5, только и входящий трафик балансируется между интерфейсами. Полученная балансировка нагрузки достигается опросом ARP. Драйвер перехватывает ответы ARP, направленные в локальной системе в поисках выхода и перезаписывает исходный адрес сетевой карты с уникальным аппаратным адресом одного из интерфейсов в группе.

*Пример конфигурирования.*

```
sudo apt install ifenslave
sudo modprobe bonding
sudo ip link add bond0 type bond mode 802.3ad
sudo ip link set eno1 down
sudo ip link set eno2 down
sudo ip link set eno1 master bond0
sudo ip link set en02 master bond0
sudo ip link set bond0 up
```

---

5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

---

Ответ.


*В сети с префиксом /29 содержится 2^(32-29)=2^3=8 адресов.*  
*В сети с префиксом /24 содержится 2^(32-24)=2^8=256 адресов*  
*В сети с префиксом /29 можно создать 256:8=32 с префиксом /24*  
*К примеру первая сеть* `10.0.10.0/29`.  
*Последняя сеть* `10.0.10.248/29`.  

---

6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

---

Ответ.

*Можно выделить блок из  подсети 100.64.0.0/10.* [RFC 6598](https://www.rfc-editor.org/rfc/rfc6598.html)  
*Например 100.127.255.192/26. У нас будет сеть на 62 хоста.*  

---

7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

---

Ответ.


*Linux:*  
 - *посмотреть всю таблицу:* `ip neighbour show`  
 - *удалить всю таблицу:* `sudo ip neighbour flush all`  
 - *удалить конкретный IP:* `sudo ip neighbour delete <IP> dev <IF>`


*Windows:* 
 - *посмотреть всю таблицу:* `arp -a`  
 - *удалить всю таблицу:* `arp -d`  
 - *удалить конкретный IP:* `arp -d <IP>`

---

